#+TITLE: Emacs Config
#+AUTHOR: Willem Boshoff

* Software development

** Terminal Config

Programmers basically live in the terminal, we might as well make it look cool.

#+begin_src emacs-lisp
  (defun efs/configure-eshell ()
    ;; Save command history when commands are entered
    (add-hook 'eshell-pre-command-hook 'eshell-save-some-history)
    ;; Truncate buffer for performance
    (add-to-list 'eshell-output-filter-functions 'eshell-truncate-buffer)
    (setq eshell-history-size         10000
	  eshell-buffer-maximum-lines 10000
	  eshell-hist-ignoredups t
	  eshell-scroll-to-bottom-on-input t))

  (use-package eshell-git-prompt
    :after eshell)

  (use-package eshell
    :hook (eshell-first-time-mode . efs/configure-eshell)
    :config
    (with-eval-after-load 'esh-opt
      (setq eshell-destroy-buffer-when-process-dies t)
      (setq eshell-visual-commands '("htop" "vim" "nvim")))
    (eshell-git-prompt-use-theme 'powerline))
#+end_src

** Project navigation

#+begin_src emacs-lisp
  (use-package projectile
    :bind-keymap
    ("C-c p" . projectile-command-map)
    :config
    (setq projectile-project-search-path '("~/code" ("~/source" . 1)))
    (setq projectile-indexing-method 'native)
    (setq projectile-sort-order 'recently-active)
    (setq projectile-enable-caching t)
    (projectile-mode +1)
    )

  (use-package treemacs-projectile
    :after treemacs)
#+end_src

** Git Capabilities

Magit is an interface that gives you a lot of git functionality
and control over your repositories

#+begin_src emacs-lisp
  (use-package magit
    :defer
    )

  (use-package magit-todos)

  (use-package treemacs-magit
    :after treemacs)
#+end_src

It is really helpful to some visual indication
in a buffer of git changes to the file being worked on.

#+begin_src emacs-lisp
  (use-package git-gutter
    :config
    (global-git-gutter-mode +1)
    (setq git-gutter:modified-sign "   "
	  git-gutter:added-sign "   "
	  git-gutter:deleted-sign "   "
	  git-gutter:window-width 2)
    (set-face-background 'git-gutter:modified "LightBlue") ;; background color
    (set-face-background 'git-gutter:added "LightGreen")
    (set-face-background 'git-gutter:deleted "LightCoral")
    )
#+end_src

Merge conflicts are real

#+begin_src emacs-lisp
  (use-package smerge-mode)

  (use-package ediff)
#+end_src

** LSP functionality

LSP provides intellisense, code actions, refactoring, etc.

#+begin_src emacs-lisp
  (defun wb/lsp-setup()
    (setq lsp-idle-delay 0.500
	  lsp-log-io nil
	  lsp-modeline-code-actions-segments '(count icon name)
	  lsp-headerline-breadcrumb-segments '(path-up-to-project file symbols)
	  lsp-modeline-diagnostics-scope :workspace
	  lsp-auto-execute-action nil
	  lsp-diagnostic-clean-after-change t
	  lsp-headerline-breadcrumb-enable-symbol-numbers nil
	  lsp-lens-place-position 'above-line
	  lsp-semantic-tokens-honor-refresh-requests t
	  lsp-semantic-tokens-apply-modifiers nil
	  lsp-modeline-diagnostics-enable t
	  lsp-modeline-code-actions-enable t
	  lsp-breadcrumb-enable t
	  lsp-lens-enable t
	  lsp-semantic-tokens-enable t
	  lsp-dired-enable t)
    )

  (use-package lsp-mode
    :init
    (setq lsp-keymap-prefix "C-c l")
    :config
    (wb/lsp-setup)
    (lsp-enable-which-key-integration t)
    :custom
    (setq lsp-eldoc-render-all t)
    (setq lsp-rust-analyzer-server-display-inlay-hints t)
    ;; vue
    (setq lsp-vetur-format-default-formatter-css "none"
	  lsp-vetur-format-default-formatter-html "none"
	  lsp-vetur-format-default-formatter-js "none"
	  lsp-vetur-validation-template nil)
    :hook
    (csharp-mode . lsp-deferred)
    (dockerfile-mode . lsp-deferred)
    (go-mode . lsp-deferred)
    (rustic-mode . lsp-deferred)
    (yaml-mode . lsp-deferred)
    (lsp-deferred-mode . lsp-modeline-diagnostics-mode)
    (lsp-deferred-mode . lsp-modeline-code-actions-mode)
    (lsp-deferred-mode . lsp-lens-mode)
    (lsp-deferred-mode . lsp-semantic-tokens-mode)
    (lsp-deferred-mode . lsp-dired-mode)
    (lsp-deferred-mode . lsp-enable-which-key-integration)
    (before-save . lsp-format-buffer)
    (before-save . lsp-organize-imports)
    :commands (lsp lsp-deferred)
    )
#+end_src

** UI layer

This provides some GUI functionality on top of LSP.

#+begin_src emacs-lisp
  (use-package lsp-ui
    :init
    (setq lsp-ui-doc-enable t
	  lsp-ui-doc-position 'top
	  lsp-ui-doc-show-with-cursor t
	  lsp-ui-doc-show-with-mouse t
	  lsp-ui-sideline-enable nil
	  lsp-ui-sideline-show-code-actions t
	  lsp-ui-sideline-show-hover t
	  lsp-ui-sideline-show-diagnostics t)
    :commands (lsp-ui-mode)
    )
#+end_src

** Debugging

#+begin_src emacs-lisp
  (use-package dap-mode)
  ;; (use-package dap-LANGUAGE) to load the dap adapter for your language

  (use-package posframe
    ;; Posframe is a pop-up tool that must be manually installed for dap-mode
    )
#+end_src

** Other LSP integrations

Lots of packages provides special/extended funtionality when LSP is available.

#+begin_src emacs-lisp
  (use-package lsp-treemacs
    :init
    (lsp-treemacs-sync-mode 1)
    :commands (lsp-treemacs-errors-list)
    )

  (use-package consult-lsp)

  ;; For Scala
  (use-package lsp-metals)
#+end_src
